image: archlinux
packages:
  - racket
  - python
  - python-pygments
  - p7zip
sources:
  - https://github.com/kisaragi-hiu/kisaragi-hiu.com
secrets:
  - 5c8f8983-4435-4e42-8388-2fa7987794aa
tasks:
  - install-racket-packages: |
      raco pkg install --skip-installed --deps search-auto pollen txexpr threading css-expr
  - build: |
      cd kisaragi-hiu.com
      make zip
  - deploy: |
      cd kisaragi-hiu.com
      set +x
      netlify_access_token="$(cat ~/.netlify-access-token)"
      curl -H "Content-Type: application/zip" \
           -H "Authorization: Bearer $netlify_access_token" \
           --data-binary "@public.zip" \
           https://api.netlify.com/api/v1/sites/a9979c17-2cfe-4bc9-9dd9-ee9e6bf1b161/deploys
