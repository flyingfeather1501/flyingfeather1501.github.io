{{ define "main" }}

{{ if .Params.hugo_notitlecase }}
  {{ .Scratch.Set "titlecase" false }}
{{ else }}
  {{ .Scratch.Set "titlecase" true }}
{{ end }}

<!-- Going through term pages: -->
<!-- <ul>
     {{ range (where .Site.AllPages "Kind" "term" ) }}
     {{ if (in (.Page.Param $.Data.Plural) (anchorize $.LinkTitle)) }}
     <li>{{ .Page }}</li>
     {{ end }}
     {{ end }}
     </ul>
-->
{{ partial "heading-with-links" . }}

<!-- Display the tags of this term page.
     HACK: getting around the fact that Hugo doesn't seem to allow
     tagging list pages. -->
{{ $tags := (slice)}}
{{ range (.Param "tags") }}
{{ $tags = (union $tags (slice (partial "func-tag-name-to-page" .))) }}
{{ end }}
{{ with $tags }}
  {{ partial "tags" . }}
{{ end }}

{{ if .Params.toc }}
{{ partial "toc" . }}
{{ end }}

{{ if .Params.hugo_nolist}}
{{ partial "content" . }}
{{ else }}
<root>
  {{ partial "content" . }}
  {{ $tagged := (slice) }}
  {{ range (where .Site.AllPages "Kind" "term" ) }}
    {{ if (in (.Page.Param $.Data.Plural) (anchorize $.LinkTitle)) }}
      {{ $tagged = (union $tagged (slice .Page))}}
    {{ end }}
  {{ end }}
  {{ with $tagged }}
  <h2>Terms</h2>
  <ul class="index">
  {{ range $tagged }}
      <li>{{ partial "index-item" . }}</li>
  {{ end }}
  </ul>
  {{ end }}
  {{ with .Pages }}
  <h2>Pages</h2>
  <ul class="index">
      {{ range .}}
      {{ partial "index-item" . }}
      {{ end }}
  </ul>
  {{ end }}
</root>
{{ end }} {{ end }}
